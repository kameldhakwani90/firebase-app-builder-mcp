#!/usr/bin/env node

const { program } = require('commander');
let chalk;
try {
  chalk = require('chalk');
} catch (error) {
  chalk = {
    blue: (text) => text,
    green: (text) => text,
    yellow: (text) => text,
    red: (text) => text,
    white: (text) => text
  };
}
const packageJson = require('../package.json');

// Configuration du programme principal
program
  .name('prixigrad')
  .description('ğŸ­ PRIXIGRAD.IO Agent - Transformateur d\'applications Firebase')
  .version(packageJson.version)
  .configureOutput({
    writeErr: (str) => process.stdout.write(`[ERROR] ${str}`)
  });

// Banner de dÃ©marrage  
console.log(`
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                ğŸ­ PRIXIGRAD.IO AGENT                     â•‘
â•‘              v${packageJson.version} - Transformation Tool              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
`);

// Commande: prixigrad init
program
  .command('init')
  .description('Initialise PRIXIGRAD.IO sur cette machine')
  .option('-f, --force', 'Force la rÃ©installation mÃªme si dÃ©jÃ  configurÃ©')
  .option('-v, --verbose', 'Affichage dÃ©taillÃ©')
  .action(require('../lib/cli/commands/init'));

// Commande: prixigrad start  
program
  .command('start')
  .description('Lance l\'interface web PRIXIGRAD.IO')
  .option('-p, --port <port>', 'Port pour l\'interface web', '3000')
  .option('-b, --bridge-port <port>', 'Port pour le bridge API', '3001')
  .option('-d, --dev', 'Mode dÃ©veloppement')
  .action(require('../lib/cli/commands/start'));

// Commande: prixigrad transform <url>
program
  .command('transform <github-url>')
  .description('Transforme une application Firebase en app complÃ¨te')
  .option('-t, --token <token>', 'Token GitHub pour repos privÃ©s')
  .option('-o, --output <dir>', 'RÃ©pertoire de sortie', './output')
  .option('-b, --branch <name>', 'Nom de la branche de production', 'prod-auto')
  .option('--skip-analysis', 'Passer l\'Ã©tape d\'analyse interactive')
  .action(require('../lib/cli/commands/transform'));

// Commande: prixigrad status
program
  .command('status')
  .description('VÃ©rifie le statut du systÃ¨me et des agents MCP')
  .option('-a, --all', 'VÃ©rification complÃ¨te de tous les composants')
  .action(require('../lib/cli/commands/status'));

// Commande: prixigrad config
program
  .command('config')
  .description('Configuration du systÃ¨me')
  .option('--reset', 'Remet Ã  zÃ©ro la configuration')
  .option('--show', 'Affiche la configuration actuelle')
  .action(require('../lib/cli/commands/config'));

// Commande: prixigrad logs
program
  .command('logs')
  .description('Affiche les logs des derniÃ¨res transformations')
  .option('-n, --lines <number>', 'Nombre de lignes Ã  afficher', '50')
  .option('-f, --follow', 'Suivi en temps rÃ©el')
  .action(require('../lib/cli/commands/logs'));

// Gestion des erreurs globales
program.exitOverride();

try {
  program.parse(process.argv);
} catch (err) {
  console.error(`âŒ Erreur: ${err.message}`);
  process.exit(1);
}

// Si aucune commande n'est fournie, afficher l'aide
if (!process.argv.slice(2).length) {
  program.outputHelp();
}